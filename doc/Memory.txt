----------------------------------------------------------------
| PhoeniX OS                                                   |
| (c) DJ PhoeniX, 2012                                         |
| https://djphoenix.ru/category/it/os/                         |
----------------------------------------------------------------

== Менеджер памяти ==
При инициализации менеджера памяти собирается информация об используемых ресурсах, после чего заполняется таблица страниц.
Таблица страниц изначально устанавливает для доступа первые 8 мегабайт RAM "как есть" (начальная установка этих страниц происзодит в файле src/x32to64.s)
Страницам, используемым BIOS и ядром, устанавливается флаг system.
Уже используемым страницам (как системным, так и всем остальным) устанавливается флан used.
При выделении памяти функцией malloc проверяются используемые страницы с флагом used. Если в странице найден блок достаточной длины, выделяется он. В противном случае происходит проверка доступных страниц без флага system. Если страница найдена, устанавливается флаг used.
Если свободных страниц с этим флагом нет, происходит выделение новой страницы для разметки памяти, после чего одной из страниц устанавливается флаг used.
После нахождения или выделения свободной страницы, происходит выделение в ней блока памяти необходимоно размера.
При освобождении памяти, проверяются страницы, в которых нет выделенных блоков. Если такие страницы найдены, флаг used с них снимается.
Для хранения списка выделенных блоков используется массив записей размером 16 байт (8 байт - начало блока, 8 байт - длина блока). Если количество записей превышает 256 (*8 = 4096 байт = 1 страница), последний элемент указывает на продолжение массива. Страницам с этим массивом установлен флаг system, при уменьшении количества выделенных блоков страницы освобождаются и флаг system снимается.